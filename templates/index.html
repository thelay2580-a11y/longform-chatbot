<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì‡¼ì¸  íŠ¸ë Œë“œ íƒìƒ‰ê¸°</title>
  <style>
    body { font-family: system-ui, -apple-system, "Apple SD Gothic Neo", sans-serif; margin: 16px; }
    input, select, button, textarea { padding: 10px; margin: 6px 0; width: 100%; max-width: 720px; box-sizing: border-box; }
    textarea { min-height: 92px; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; vertical-align: top; }
    th { background: #f5f5f5; }
    .hint { color: #555; font-size: 13px; margin: 10px 0; max-width: 720px; line-height: 1.35; }
    .rowbtn { width: auto; padding: 8px 10px; cursor: pointer; font-weight: bold; }
    pre { white-space: pre-wrap; border: 1px solid #ddd; padding: 12px; margin-top: 12px; max-width: 980px; }
  </style>
</head>
<body>
  <h2>ì‡¼ì¸  íŠ¸ë Œë“œ íƒìƒ‰ê¸°</h2>

  <div class="hint">
    âœ… ì‚¬ìš© íë¦„: (1) ê²€ìƒ‰ â†’ (2) TOP 1~100 ì¤‘ ì„ íƒ â†’ (3) í•µì‹¬ ìš”ì•½ 3~4ì¤„ ì…ë ¥(ê°€ëŠ¥í•˜ë©´) â†’ (4) [ğŸ“‹ ì œì‘ ì§€ì¹¨ ë³µì‚¬] â†’ (5) ë‹¤ë¥¸ í•™ìŠµ AIì— ë¶™ì—¬ë„£ê¸°<br/>
    - <b>í˜¼í•© ì¶”ì²œìˆœ</b>: í­ë°œ+ì¬í˜„ ì ˆì¶© / <b>íŠ¸ë˜í”½ í­ë°œìˆœ</b>: v/h ì¤‘ì‹¬ / <b>ì‹ ì¸ ì¬í˜„ìˆœ</b>: view/sub ì¤‘ì‹¬
  </div>

  <label>ê²€ìƒ‰ì–´</label>
  <input id="query" placeholder="ì˜ˆ: ì •ì¹˜, ë‰´ìŠ¤, ê±´ê°•, ì˜í•™, ì‹œë‹ˆì–´, ê²½ì œ, ìƒí™œ" />

  <label>ê¸°ê°„ (ì—…ê·¸ë ˆì´ë“œë¨!)</label>
  <select id="days">
    <option value="1">ì˜¤ëŠ˜(1ì¼)</option>
    <option value="3" selected>ìµœê·¼ 3ì¼</option>
    <option value="7">ìµœê·¼ 7ì¼</option>
    <option value="30">ìµœê·¼ 30ì¼</option>
    <option value="365">ìµœê·¼ 1ë…„</option>
    <option value="3650">ì „ì²´ (ëª¨ë“  ê¸°ê°„)</option>
  </select>

  <label>ìµœì†Œ ì¡°íšŒìˆ˜(í•„í„°)</label>
  <input id="min_views" type="number" value="5000" />

  <label>ì •ë ¬ ê¸°ì¤€</label>
  <select id="sort_by">
    <option value="final" selected>í˜¼í•© ì¶”ì²œìˆœ</option>
    <option value="traffic">íŠ¸ë˜í”½ í­ë°œìˆœ</option>
    <option value="replication">ì‹ ì¸ ì¬í˜„ìˆœ</option>
  </select>

  <label>ì¹´í…Œê³ ë¦¬ (ë³µì‚¬ìš© ì§€ì¹¨ì— ìë™ ë°˜ì˜)</label>
  <select id="category">
    <option value="politics_news" selected>ì •ì¹˜/ë‰´ìŠ¤/ì´ìŠˆ</option>
    <option value="economy">ê²½ì œ/ì¬í…Œí¬/ë¶€ë™ì‚°</option>
    <option value="health_life">ê±´ê°•/ì˜í•™/ì‹œë‹ˆì–´/ìƒí™œ</option>
  </select>

  <label>í•µì‹¬ ë‚´ìš© ìš”ì•½ (VIDEO_SUMMARY) â€” ê°€ëŠ¥í•˜ë©´ 3~4ì¤„ë¡œ ì…ë ¥</label>
  <textarea id="video_summary" placeholder="ì˜ˆ) 1) â—‹â—‹ ì •ì±… ë…¼ë€ í•µì‹¬ì€ â–³â–³  2) ë°˜ëŒ€/ì°¬ì„± ìŸì   3) ì‹œì²­ìì—ê²Œ ë¯¸ì¹˜ëŠ” ì˜í–¥  4) ê²°ë¡ /ì£¼ì˜ì "></textarea>

  <button id="btn">íŠ¸ë Œë“œ ì°¾ê¸°(ì‡¼ì¸ ë§Œ)</button>

  <div id="status" style="margin-top:10px; font-weight: bold; color: blue;"></div>

  <table id="tbl" style="display:none;">
    <thead>
      <tr>
        <th>ìˆœìœ„</th>
        <th>ì ìˆ˜(í˜¼í•©/í­ë°œ/ì¬í˜„)</th>
        <th>ì œëª©/ë§í¬</th>
        <th>ì±„ë„</th>
        <th>ì¡°íšŒìˆ˜</th>
        <th>ì¢‹ì•„ìš”</th>
        <th>v/h</th>
        <th>view/sub</th>
        <th>ì—…ë¡œë“œ ë‚ ì§œ</th>
        <th>ë³µì‚¬</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <pre id="resultBox" style="display:none;"></pre>

<script>
let LAST_ROWS = [];

const btn = document.getElementById("btn");
btn.onclick = async () => {
  const query = document.getElementById("query").value.trim();
  const days = parseInt(document.getElementById("days").value, 10);
  const min_views = parseInt(document.getElementById("min_views").value, 10);
  const sort_by = document.getElementById("sort_by").value;

  if (!query) { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"); return; }

  document.getElementById("status").innerText = "â³ ìœ íŠœë¸Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... (ì•½ 3~5ì´ˆ ì†Œìš”)";
  document.getElementById("tbl").style.display = "none";
  
  try {
    const res = await fetch("/api/trends", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ query, days, min_views, topn: 100, sort_by })
    });

    const data = await res.json();
    if (!res.ok) {
      document.getElementById("status").innerText = "âŒ ì˜¤ë¥˜: " + (data.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");
      return;
    }

    const rows = data.rows || [];
    LAST_ROWS = rows;

    if (rows.length === 0) {
      document.getElementById("status").innerText = "ì¡°ê±´ì— ë§ëŠ” ì‡¼ì¸  ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.";
      return;
    }

    document.getElementById("status").innerText = `âœ… ê²°ê³¼ ${rows.length}ê°œ ì™„ë£Œ!`;
    const tbody = document.querySelector("#tbl tbody");
    tbody.innerHTML = "";
    document.getElementById("tbl").style.display = "";

    rows.forEach((r, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><b>${idx+1}</b></td>
        <td>
          <div style="color:blue;"><b>${num(r.final_score)}</b> (í˜¼í•©)</div>
          <div style="color:red;">${num(r.traffic_score)} (í­ë°œ)</div>
          <div style="color:green;">${num(r.replication_score)} (ì¬í˜„)</div>
        </td>
        <td><a href="${r.video_url}" target="_blank" style="text-decoration:none;">${escapeHtml(r.title)}</a></td>
        <td><a href="${r.channel_url}" target="_blank">${escapeHtml(r.channel_title)}</a></td>
        <td>${r.views.toLocaleString()}</td>
        <td>${r.likes.toLocaleString()}</td>
        <td>${num(r.views_per_hour)}</td>
        <td>${num(r.view_sub_ratio)}</td>
        <td>${escapeHtml(r.published_at)}</td>
        <td><button class="rowbtn" onclick="copyBrief(${idx})">ğŸ“‹ ì œì‘ ì§€ì¹¨ ë³µì‚¬</button></td>
      `;
      tbody.appendChild(tr);
    });
  } catch (e) {
    document.getElementById("status").innerText = "âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
  }
};

function categoryLabel(v){
  if (v === "health_life") return "ê±´ê°•/ì˜í•™/ì‹œë‹ˆì–´/ìƒí™œ";
  if (v === "economy") return "ê²½ì œ/ì¬í…Œí¬/ë¶€ë™ì‚°";
  return "ì •ì¹˜/ë‰´ìŠ¤/ì´ìŠˆ";
}

function buildBriefText(row, rank){
  const category = document.getElementById("category").value;
  const summary = (document.getElementById("video_summary").value || "").trim();

  const safeSummary = summary ? summary : "â€» (ìš”ì•½ ë¯¸ì…ë ¥) ì œê³µëœ ì •ë³´ì™€ ë§¥ë½ì„ ì¶”ì •í•˜ì—¬, í—ˆìœ„ ì‚¬ì‹¤ ì—†ì´ ì™„ë²½í•˜ê²Œ ì¬êµ¬ì„±í•˜ì„¸ìš”.";

  // ì¹´í…Œê³ ë¦¬ë³„ ì˜ë¬¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìŠ¤íƒ€ì¼ ìë™ ì„¤ì •
  let imageStyle = "";
  if (category === "politics_news") {
    imageStyle = "Documentary news style, realistic, credible, newsroom atmosphere";
  } else if (category === "economy") {
    imageStyle = "Professional financial style, wealth, success, realistic, modern office or chart background";
  } else {
    imageStyle = "Warm senior lifestyle style, empathetic, realistic, everyday Korean life mood";
  }

  return `[íŠ¸ë Œë“œ ê¸°ë°˜ ì‡¼ì¸  ì œì‘ ì§€ì¹¨ v3]

1. ì°¸ê³  ì˜ìƒ ì •ë³´
- ì˜ìƒ ë§í¬: ${row.video_url}
- ì±„ë„: ${row.channel_title}
- ìµœê·¼ íŠ¸ë Œë“œ ìˆœìœ„: TOP ${rank} / 100
- ì¡°íšŒìˆ˜: ${row.views.toLocaleString()}
- ì¡°íšŒ ì†ë„(v/h): ${row.views_per_hour}
- êµ¬ë…ì ëŒ€ë¹„(view/sub): ${row.view_sub_ratio}

2. í•µì‹¬ ë‚´ìš© ìš”ì•½ (ê²€ìƒ‰ê¸°/ìš´ì˜ì ì…ë ¥)
${safeSummary}

â€» ìœ„ ìš”ì•½ì€ ì°¸ê³  ì˜ìƒì˜ í•µì‹¬ ë§¥ë½ì„ ì •ë¦¬í•œ ê²ƒì´ë©°, AIëŠ” ì´ ìš”ì•½ì„ ê¸°ì¤€ìœ¼ë¡œ ì£¼ì œë¥¼ ì´í•´í•˜ë˜ í‘œí˜„Â·ë¬¸ì¥Â·ì „ê°œëŠ” ì™„ì „íˆ ìƒˆë¡­ê²Œ ì¬êµ¬ì„±í•´ì•¼ í•œë‹¤.

3. ì™œ ì´ ì˜ìƒì´ ëœ¨ëŠ”ê°€ (íŠ¸ë Œë“œ ë¶„ì„)
- ê²€ìƒ‰ ê¸°ê°„ ë‚´ ì¡°íšŒ ì†ë„ê°€ ë§¤ìš° ë¹ ë¦„
- ì œëª©/í›…ì´ ì‹œì²­ìì˜ â€˜í˜¸ê¸°ì‹¬Â·ì†í•´ íšŒí”¼â€™ ì‹¬ë¦¬ë¥¼ ê°•í•˜ê²Œ ìê·¹í•¨
- í˜„ì¬ ì¹´í…Œê³ ë¦¬ íë¦„ê³¼ ë§ë¬¼ë¦¼: ${categoryLabel(category)}

4. ì œì‘ ë°©í–¥ (ì¤‘ìš”)
- ì°¸ê³  ì˜ìƒì˜ ë¬¸ì¥/ì „ê°œ/í‘œí˜„ì„ ì ˆëŒ€ ê·¸ëŒ€ë¡œ ëª¨ë°©í•˜ì§€ ë§ ê²ƒ!
- ê°™ì€ ì£¼ì œë¼ë„ ì§ˆë¬¸Â·ê°ë„Â·í›…ì€ ì™„ì „íˆ ìƒˆë¡­ê²Œ êµ¬ì„±í•  ê²ƒ
- ì‹œì²­ìê°€ "ì´ê±´ ê¼­ ë´ì•¼ í•´!"ë¼ê³  ëŠë¼ê²Œ ë§Œë“¤ ê²ƒ

5. ì‡¼ì¸  ì œì‘ ìš”êµ¬ì‚¬í•­
- ëŒ€ë³¸ ê¸¸ì´: í•œêµ­ì–´ ë„ì–´ì“°ê¸° í¬í•¨ 300ì~400ì ë‚´ì™¸ (ë‚˜ë ˆì´ì…˜ 40~60ì´ˆ ë¶„ëŸ‰)
- 0~2ì´ˆ: ê°•ë ¥í•œ í›… (ê²½ê³ /ì§ˆë¬¸/ë°˜ì „)
- 3~7ì´ˆ: ëê¹Œì§€ ë´ì•¼ í•˜ëŠ” ì´ìœ  ì œì‹œ
- ì¤‘ë°˜: í•µì‹¬ ì •ë³´ 3í¬ì¸íŠ¸
- ë§ˆë¬´ë¦¬(ë§ˆì§€ë§‰ 5ì´ˆ): í•µì‹¬ í•œ ì¤„ ìš”ì•½ + ìì—°ìŠ¤ëŸ¬ìš´ 'ì¢‹ì•„ìš” ë° êµ¬ë…' ìœ ë„ ë¬¸ì¥

6. ì¹´í…Œê³ ë¦¬ë³„ í†¤ & ì•ˆì „ ê·œì¹™

[ì •ì¹˜/ë‰´ìŠ¤/ì´ìŠˆ (ì• êµ­ ë‰´ìŠ¤ í¬í•¨)]
- íŒ©íŠ¸ëŠ” ê°ê´€ì ìœ¼ë¡œ ì „ë‹¬í•˜ë˜, ë‚˜ë ˆì´ì…˜ í†¤ì€ ê²½ê°ì‹¬ì„ ì¼ê¹¨ìš°ëŠ” ë‚ ì¹´ë¡­ê³  í˜¸ì†Œë ¥ ìˆëŠ” ë§íˆ¬ ìœ ì§€
- í™•ì¸ë˜ì§€ ì•Šì€ ë‚´ìš©ì€ 'ë³´ë„ì— ë”°ë¥´ë©´', 'ë…¼ë€ì´ ë˜ê³  ìˆë‹¤' ë“±ìœ¼ë¡œ í‘œí˜„
- í˜ì˜¤/ì„ ë™/ìŒëª¨ë¡  ë‹¨ì • ì ˆëŒ€ ê¸ˆì§€

[ê²½ì œ/ì¬í…Œí¬/ë¶€ë™ì‚°]
- íŠ¹ì • ì£¼ì‹/ì½”ì¸/ë¶€ë™ì‚°ì— ëŒ€í•œ 'ë¬´ì¡°ê±´ì ì¸ ë§¤ìˆ˜/ë§¤ë„ ì¶”ì²œ' ì ˆëŒ€ ê¸ˆì§€
- ì§€ë‚˜ì¹œ ìˆ˜ìµë¥  ê³¼ì¥ì´ë‚˜ í—ˆìœ„ ë³´ì¥ ê¸ˆì§€
- ì‹œì²­ìì˜ 'ì†ì‹¤ íšŒí”¼ ì‹¬ë¦¬'ë¥¼ ìê·¹í•˜ë˜ ì² ì €íˆ ê°ê´€ì  ìˆ˜ì¹˜ì™€ ê·¼ê±° ìœ„ì£¼ë¡œ ì„¤ëª…í•  ê²ƒ

[ê±´ê°•/ì˜í•™/ì‹œë‹ˆì–´/ìƒí™œ]
- ì¹˜ë£ŒÂ·ì™„ì¹˜ ë‹¨ì • ê¸ˆì§€, 'ê°œì¸ì°¨ê°€ ìˆì„ ìˆ˜ ìˆìŒ' ëª…ì‹œ ë˜ëŠ” ì˜ì‚¬ ìƒë‹´ ê¶Œìœ 
- ê³¼ë„í•œ ê³µí¬ ì¡°ì¥ ê¸ˆì§€ (ë‹¨, ì‹¤ìƒí™œ ì£¼ì˜ì ì€ ëª…í™•íˆ ê°•ì¡°)
- ì‹œë‹ˆì–´ê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ ë‹¨ì–´ì™€ í¸ì•ˆí•œ ë§íˆ¬ ì‚¬ìš©

7. ì¶œë ¥ ìš”ì²­ (ì•„ë˜ ìˆœì„œë¡œ ì‘ì„±)

â‘  í´ë¦­ ìœ ë„ ì œëª© 5ê°œ
â‘¡ ì¸ë„¤ì¼ ë¬¸êµ¬ 5ê°œ (15ì ë‚´ì™¸, í…ìŠ¤íŠ¸ë§Œ)
â‘¢ ì‡¼ì¸  ëŒ€ë³¸ 1ê°œ (300~400ì, ë‚˜ë ˆì´ì…˜ ê¸°ì¤€)
â‘£ ìœ íŠœë¸Œ ì˜ìƒ ì„¤ëª…ë€ 1ê°œ (2~3ì¤„)
â‘¤ í•´ì‹œíƒœê·¸ 20ê°œ (ì‰¼í‘œë¡œ êµ¬ë¶„)

â‘¥ ì¸ë„¤ì¼ìš© ì˜ë¬¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ 1ê°œ
- Korean person(s), Korean setting
- ${imageStyle}
- cinematic lighting, high contrast, 9:16 aspect ratio, ultra realistic, no text, no subtitles

â‘¦ ì˜ìƒ ë°°ê²½ìš© ì˜ë¬¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ 6ê°œ
- ëŒ€ë³¸ íë¦„ì— ë§ì¶˜ ì¥ë©´ 6ê°œ ë¬˜ì‚¬
- Korean person(s), Korean setting
- ${imageStyle}
- each prompt independent, 9:16 aspect ratio, ultra realistic, no text, no subtitles

âš ï¸ ì €ì‘ê¶Œ ì•ˆì „ ì¬êµ¬ì„± í•„ìˆ˜
âš ï¸ ì°¸ê³  ì˜ìƒê³¼ ìœ ì‚¬í•œ ë¬¸ì¥/êµ¬ì„±/ìˆœì„œ ì‚¬ìš© ê¸ˆì§€
`;
}

async function copyBrief(idx){
  const row = LAST_ROWS[idx];
  if (!row) return;

  const text = buildBriefText(row, idx + 1);

  const box = document.getElementById("resultBox");
  box.style.display = "block";
  box.textContent = text;

  try {
    await navigator.clipboard.writeText(text);
    document.getElementById("status").innerText = "âœ… [ë³µì‚¬ ì™„ë£Œ] ì´ì œ ë‹¤ë¥¸ í•™ìŠµ AI(Gems ë“±)ì— Ctrl+V ë¡œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”!";
  } catch (e) {
    selectText(box);
    document.getElementById("status").innerText = "âš ï¸ ìë™ ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ). ì•„ë˜ í…ìŠ¤íŠ¸ê°€ íŒŒë—ê²Œ ì„ íƒë˜ì—ˆìœ¼ë‹ˆ ì§ì ‘ ë³µì‚¬(Ctrl+C) í•´ì£¼ì„¸ìš”.";
  }
}

function selectText(el){
  const range = document.createRange();
  range.selectNodeContents(el);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

function num(v){ if (v === null || v === undefined) return ""; return String(v); }
function escapeHtml(str){ return (str||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
</script>
</body>
</html>